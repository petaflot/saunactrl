<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Sauna Control</title>
  <script>
    let ws;

    window.onload = () => {
      ws = new WebSocket("ws://" + window.location.host + "/ws");

      ws.onopen = () => {
        console.log("WebSocket connected");
      };

      ws.onmessage = (event) => {
        console.log("WebSocket message:", event.data);
        try {
          const data = JSON.parse(event.data);
          document.getElementById("currentTemp").textContent = data.temp.toFixed(1);
          document.getElementById("currentTarget").value = data.target.toFixed(1);
          document.getElementById("currentStatus").textContent = data.enabled ? "On" : "Off";
        } catch (e) {
          console.error("Failed to parse message:", e);
        }
      };

      document.getElementById("toggleBtn").onclick = () => {
        const current = document.getElementById("currentStatus").textContent;
        ws.send(current === "Off" ? "enable" : "disable");
      };

      document.getElementById("currentTarget").onchange = () => {
        const val = document.getElementById("currentTarget").value;
        ws.send("target:" + val);
      };
    };
  </script>
</head>
<body>
  <h1>Sauna</h1>
  <h2>Controls</h2>
  <table>
    <tr>
      <td>Power:</td>
      <td><button id="toggleBtn">Toggle</button></td>
      <td>Status: <span id="currentStatus">Unknown</span></td>
    </tr>
    <tr>
      <td>Target temperature:</td>
      <td><input type="number" id="currentTarget" step="0.5" min="0" max="120"> °C</td>
      <td>Current: <span id="currentTemp">--</span> °C</td>
    </tr>
  </table>
</body>
</html>
